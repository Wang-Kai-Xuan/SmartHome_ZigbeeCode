###############################################################################
#                                                                             #
# IAR C/C++ Compiler V8.10.3.10338/W32 for 8051         05/Sep/2016  09:20:27 #
# Copyright 2004-2011 IAR Systems AB.                                         #
#                                                                             #
#    Core               =  plain                                              #
#    Code model         =  banked                                             #
#    Data model         =  large                                              #
#    Calling convention =  xdata reentrant                                    #
#    Constant location  =  data_rom                                           #
#    Dptr setup         =  1,16                                               #
#    Source file        =  H:\project\SmartHome\Projects\zstack\Samples\Smart #
#                          Home\Source\SmartHome.c                            #
#    Command line       =  -f H:\project\SmartHome\Projects\zstack\Samples\Sm #
#                          artHome\CC2530DB\..\..\..\Tools\CC2530DB\f8wCoord. #
#                          cfg (-DCPU32MHZ -DROOT=__near_func                 #
#                          -DMAC_CFG_APP_PENDING_QUEUE=TRUE                   #
#                          -DZDO_COORDINATOR -DRTR_NWK -DBLINK_LEDS) -f       #
#                          H:\project\SmartHome\Projects\zstack\Samples\Smart #
#                          Home\CC2530DB\..\..\..\Tools\CC2530DB\f8wConfig.cf #
#                          g (-DSECURE=0 -DZG_SECURE_DYNAMIC=0 -DREFLECTOR    #
#                          -DDEFAULT_CHANLIST=0x00000800                      #
#                          -DZDAPP_CONFIG_PAN_ID=0xFFFF                       #
#                          -DNWK_START_DELAY=100 -DEXTENDED_JOINING_RANDOM_MA #
#                          SK=0x007F -DBEACON_REQUEST_DELAY=100               #
#                          -DBEACON_REQ_DELAY_MASK=0x00FF                     #
#                          -DROUTE_EXPIRY_TIME=30 -DAPSC_ACK_WAIT_DURATION_PO #
#                          LLED=3000 -DNWK_INDIRECT_MSG_TIMEOUT=7             #
#                          -DMAX_RREQ_ENTRIES=8 -DAPSC_MAX_FRAME_RETRIES=3    #
#                          -DNWK_MAX_DATA_RETRIES=2                           #
#                          -DMAX_POLL_FAILURE_RETRIES=2 -DMAX_BCAST=9         #
#                          -DAPS_MAX_GROUPS=16 -DMAX_RTG_ENTRIES=40           #
#                          -DNWK_MAX_BINDING_ENTRIES=4                        #
#                          -DMAX_BINDING_CLUSTER_IDS=4 "-DDEFAULT_KEY={0x01,  #
#                          0x03, 0x05, 0x07, 0x09, 0x0B, 0x0D, 0x0F, 0x00,    #
#                          0x02, 0x04, 0x06, 0x08, 0x0A, 0x0C, 0x0D}"         #
#                          -DMAC_MAX_FRAME_SIZE=116 "-DCONST=const __code"    #
#                          -DGENERIC=__generic -DRFD_RCVC_ALWAYS_ON=FALSE     #
#                          -DPOLL_RATE=1000 -DQUEUED_POLL_RATE=100            #
#                          -DRESPONSE_POLL_RATE=100) -DREJOIN_POLL_RATE=440   #
#                          H:\project\SmartHome\Projects\zstack\Samples\Smart #
#                          Home\Source\SmartHome.c -D ZTOOL_P1 -D MT_TASK -D  #
#                          MT_SYS_FUNC -D MT_ZDO_FUNC -D LCD_SUPPORTED=DEBUG  #
#                          -lC H:\project\SmartHome\Projects\zstack\Samples\S #
#                          martHome\CC2530DB\CoordinatorEB\List\ -lA          #
#                          H:\project\SmartHome\Projects\zstack\Samples\Smart #
#                          Home\CC2530DB\CoordinatorEB\List\ --diag_suppress  #
#                          Pe001,Pa010 -o H:\project\SmartHome\Projects\zstac #
#                          k\Samples\SmartHome\CC2530DB\CoordinatorEB\Obj\    #
#                          -e --debug --core=plain --dptr=16,1                #
#                          --data_model=large --code_model=banked             #
#                          --calling_convention=xdata_reentrant               #
#                          --place_constants=data_rom --nr_virtual_regs 16    #
#                          -I H:\project\SmartHome\Projects\zstack\Samples\Sm #
#                          artHome\CC2530DB\ -I H:\project\SmartHome\Projects #
#                          \zstack\Samples\SmartHome\CC2530DB\..\SOURCE\ -I   #
#                          H:\project\SmartHome\Projects\zstack\Samples\Smart #
#                          Home\CC2530DB\..\..\..\ZMAIN\TI2530DB\ -I          #
#                          H:\project\SmartHome\Projects\zstack\Samples\Smart #
#                          Home\CC2530DB\..\..\..\..\..\COMPONENTS\MT\ -I     #
#                          H:\project\SmartHome\Projects\zstack\Samples\Smart #
#                          Home\CC2530DB\..\..\..\..\..\COMPONENTS\HAL\INCLUD #
#                          E\ -I H:\project\SmartHome\Projects\zstack\Samples #
#                          \SmartHome\CC2530DB\..\..\..\..\..\COMPONENTS\HAL\ #
#                          TARGET\CC2530EB\ -I H:\project\SmartHome\Projects\ #
#                          zstack\Samples\SmartHome\CC2530DB\..\..\..\..\..\C #
#                          OMPONENTS\OSAL\MCU\CCSOC\ -I                       #
#                          H:\project\SmartHome\Projects\zstack\Samples\Smart #
#                          Home\CC2530DB\..\..\..\..\..\COMPONENTS\OSAL\INCLU #
#                          DE\ -I H:\project\SmartHome\Projects\zstack\Sample #
#                          s\SmartHome\CC2530DB\..\..\..\..\..\COMPONENTS\STA #
#                          CK\AF\ -I H:\project\SmartHome\Projects\zstack\Sam #
#                          ples\SmartHome\CC2530DB\..\..\..\..\..\COMPONENTS\ #
#                          STACK\NWK\ -I H:\project\SmartHome\Projects\zstack #
#                          \Samples\SmartHome\CC2530DB\..\..\..\..\..\COMPONE #
#                          NTS\STACK\SEC\ -I H:\project\SmartHome\Projects\zs #
#                          tack\Samples\SmartHome\CC2530DB\..\..\..\..\..\COM #
#                          PONENTS\STACK\SAPI\ -I H:\project\SmartHome\Projec #
#                          ts\zstack\Samples\SmartHome\CC2530DB\..\..\..\..\. #
#                          .\COMPONENTS\STACK\SYS\ -I                         #
#                          H:\project\SmartHome\Projects\zstack\Samples\Smart #
#                          Home\CC2530DB\..\..\..\..\..\COMPONENTS\STACK\ZDO\ #
#                           -I H:\project\SmartHome\Projects\zstack\Samples\S #
#                          martHome\CC2530DB\..\..\..\..\..\COMPONENTS\ZMAC\F #
#                          8W\ -I H:\project\SmartHome\Projects\zstack\Sample #
#                          s\SmartHome\CC2530DB\..\..\..\..\..\COMPONENTS\ZMA #
#                          C\ -I H:\project\SmartHome\Projects\zstack\Samples #
#                          \SmartHome\CC2530DB\..\..\..\..\..\COMPONENTS\SERV #
#                          ICES\SADDR\ -I H:\project\SmartHome\Projects\zstac #
#                          k\Samples\SmartHome\CC2530DB\..\..\..\..\..\COMPON #
#                          ENTS\SERVICES\SDATA\ -I H:\project\SmartHome\Proje #
#                          cts\zstack\Samples\SmartHome\CC2530DB\..\..\..\..\ #
#                          ..\COMPONENTS\MAC\INCLUDE\ -I                      #
#                          H:\project\SmartHome\Projects\zstack\Samples\Smart #
#                          Home\CC2530DB\..\..\..\..\..\COMPONENTS\MAC\HIGH_L #
#                          EVEL\ -I H:\project\SmartHome\Projects\zstack\Samp #
#                          les\SmartHome\CC2530DB\..\..\..\..\..\COMPONENTS\M #
#                          AC\LOW_LEVEL\srf04\ -I H:\project\SmartHome\Projec #
#                          ts\zstack\Samples\SmartHome\CC2530DB\..\..\..\..\. #
#                          .\COMPONENTS\MAC\LOW_LEVEL\srf04\SINGLE_CHIP\      #
#                          -Ohz --require_prototypes                          #
#    List file          =  H:\project\SmartHome\Projects\zstack\Samples\Smart #
#                          Home\CC2530DB\CoordinatorEB\List\SmartHome.lst     #
#    Object file        =  H:\project\SmartHome\Projects\zstack\Samples\Smart #
#                          Home\CC2530DB\CoordinatorEB\Obj\SmartHome.r51      #
#                                                                             #
#                                                                             #
###############################################################################

H:\project\SmartHome\Projects\zstack\Samples\SmartHome\Source\SmartHome.c
      1          /*********************************************************************
      2            This application isn't intended to do anything useful, it is
      3            intended to be a simple example of an application's structure.
      4          
      5            This application sends "Hello World" to another "Generic"
      6            application every 15 seconds.  The application will also
      7            receive "Hello World" packets.
      8          
      9            The "Hello World" messages are sent/received as MSG type message.
     10          
     11            This applications doesn't have a profile, so it handles everything
     12            directly - itself.
     13          
     14            Key control:
     15              SW1:
     16              SW2:  initiates end device binding
     17              SW3:
     18              SW4:  initiates a match description request
     19          *********************************************************************/
     20          
     21          /*********************************************************************
     22           * INCLUDES
     23           */
     24          #include "OSAL.h"
     25          #include "AF.h"
     26          #include "ZDApp.h"
     27          #include "ZDObject.h"
     28          #include "ZDProfile.h"
     29          #include "SmartHome.h"
     30          #include "DebugTrace.h"
     31          
     32          #if !defined( WIN32 )
     33            #include "OnBoard.h"

   \                                 In  segment SFR_AN, at 0xf3
   \   unsigned char volatile __sfr P0SEL
   \                     P0SEL:
   \   000000                DS 1

   \                                 In  segment SFR_AN, at 0xfd
   \   unsigned char volatile __sfr P0DIR
   \                     P0DIR:
   \   000000                DS 1
     34          #endif
     35          
     36          /* HAL */
     37          #include "hal_lcd.h"
     38          #include "hal_led.h"
     39          #include "hal_key.h"
     40          #include "hal_uart.h"
     41          
     42          /*********************************************************************
     43           * MACROS
     44           */
     45          
     46          /*********************************************************************
     47           * CONSTANTS
     48           */
     49          
     50          /*********************************************************************
     51           * TYPEDEFS
     52           */
     53          
     54          /*********************************************************************
     55           * GLOBAL VARIABLES
     56           */
     57          
     58          // This list should be filled with Application specific Cluster IDs.

   \                                 In  segment XDATA_ROM_C, align 1
     59          const cId_t GenericApp_ClusterList[GENERICAPP_MAX_CLUSTERS] =
   \                     GenericApp_ClusterList:
   \   000000   0100         DW 1
     60          {
     61            GENERICAPP_CLUSTERID
     62          };
     63          

   \                                 In  segment XDATA_ROM_C, align 1
     64          const SimpleDescriptionFormat_t GenericApp_SimpleDesc =
   \                     GenericApp_SimpleDesc:
   \   000000   0A           DB 10
   \   000001   040F         DW 3844
   \   000003   0100         DW 1
   \   000005   00           DB 0
   \   000006   01           DB 1
   \   000007   ....         DW GenericApp_ClusterList
   \   000009   01           DB 1
   \   00000A   ....         DW GenericApp_ClusterList
     65          {
     66            GENERICAPP_ENDPOINT,              //  int Endpoint;
     67            GENERICAPP_PROFID,                //  uint16 AppProfId[2];
     68            GENERICAPP_DEVICEID,              //  uint16 AppDeviceId[2];
     69            GENERICAPP_DEVICE_VERSION,        //  int   AppDevVer:4;
     70            GENERICAPP_FLAGS,                 //  int   AppFlags:4;
     71            GENERICAPP_MAX_CLUSTERS,          //  byte  AppNumInClusters;
     72            (cId_t *)GenericApp_ClusterList,  //  byte *pAppInClusterList;
     73            GENERICAPP_MAX_CLUSTERS,          //  byte  AppNumInClusters;
     74            (cId_t *)GenericApp_ClusterList   //  byte *pAppInClusterList;
     75          };
     76          
     77          // This is the Endpoint/Interface description.  It is defined here, but
     78          // filled-in in GenericApp_Init().  Another way to go would be to fill
     79          // in the structure here and make it a "const" (in code space).  The
     80          // way it's defined in this sample app it is define in RAM.

   \                                 In  segment XDATA_Z, align 1, keep-with-next
     81          endPointDesc_t GenericApp_epDesc;
   \                     GenericApp_epDesc:
   \   000000                DS 6
   \   000006                REQUIRE __INIT_XDATA_Z
     82          
     83          /*********************************************************************
     84           * EXTERNAL VARIABLES
     85           */
     86          
     87          /*********************************************************************
     88           * EXTERNAL FUNCTIONS
     89           */
     90          
     91          /*********************************************************************
     92           * LOCAL VARIABLES
     93           */

   \                                 In  segment XDATA_Z, align 1, keep-with-next
     94          byte GenericApp_TaskID;   // Task ID for internal task/event processing
   \                     GenericApp_TaskID:
   \   000000                DS 1
   \   000001                REQUIRE __INIT_XDATA_Z
     95                                    // This variable will be received when
     96                                    // GenericApp_Init() is called.

   \                                 In  segment XDATA_Z, align 1, keep-with-next
     97          devStates_t GenericApp_NwkState;
   \                     GenericApp_NwkState:
   \   000000                DS 1
   \   000001                REQUIRE __INIT_XDATA_Z
     98          
     99          

   \                                 In  segment XDATA_Z, align 1, keep-with-next
    100          byte GenericApp_TransID;  // This is the unique message ID (counter)
   \                     GenericApp_TransID:
   \   000000                DS 1
   \   000001                REQUIRE __INIT_XDATA_Z
    101          

   \                                 In  segment XDATA_Z, align 1, keep-with-next
    102          afAddrType_t GenericApp_DstAddr;
   \                     GenericApp_DstAddr:
   \   000000                DS 12
   \   00000C                REQUIRE __INIT_XDATA_Z
    103          
    104          #define uchar unsigned char
    105          

   \                                 In  segment XDATA_I, align 1, keep-with-next
    106          uchar corotation[4] ={0x10,0x08,0x04,0x02}; // 正转
   \                     corotation:
   \   000000                DS 4
   \   000004                REQUIRE `?<Initializer for corotation>`
   \   000004                REQUIRE __INIT_XDATA_I
    107          // 0001 0000  0000 1000  0000 0100  0000 0010

   \                                 In  segment XDATA_I, align 1, keep-with-next
    108          uchar reverse[4]={0x02,0x04,0x08,0x10}; // 反转
   \                     reverse:
   \   000000                DS 4
   \   000004                REQUIRE `?<Initializer for reverse>`
   \   000004                REQUIRE __INIT_XDATA_I
    109          // 0000 0010  0000 0100  0000 1000  0001 0000
    110          
    111          /*********************************************************************
    112           * LOCAL FUNCTIONS
    113           */
    114          void GenericApp_ProcessZDOMsgs( zdoIncomingMsg_t *inMsg );
    115          void GenericApp_HandleKeys( byte shift, byte keys );
    116          void GenericApp_MessageMSGCB( afIncomingMSGPacket_t *pckt );
    117          void GenericApp_SendTheMessage( void );
    118          
    119          /*********************************************************************
    120           * NETWORK LAYER CALLBACKS
    121           */
    122          
    123          /*********************************************************************
    124           * PUBLIC FUNCTIONS
    125           */
    126          
    127          /*********************************************************************
    128           * @fn      GenericApp_Init
    129           *
    130           * @brief   Initialization function for the Generic App Task.
    131           *          This is called during initialization and should contain
    132           *          any application specific initialization (ie. hardware
    133           *          initialization/setup, table initialization, power up
    134           *          notificaiton ... ).
    135           *
    136           * @param   task_id - the ID assigned by OSAL.  This ID should be
    137           *                    used to send messages and set timers.
    138           *
    139           * @return  none
    140           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    141          void GenericApp_Init( byte task_id )
   \                     GenericApp_Init:
    142          {
   \   000000   74F7         MOV     A,#-0x9
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 9
   \   000005                ; Auto size: 0
   \   000005   E9           MOV     A,R1
    143            GenericApp_TaskID = task_id;
   \   000006   90....       MOV     DPTR,#GenericApp_TaskID
   \   000009   F0           MOVX    @DPTR,A
    144            GenericApp_NwkState = DEV_INIT;
   \   00000A   90....       MOV     DPTR,#GenericApp_NwkState
   \   00000D   7401         MOV     A,#0x1
   \   00000F   F0           MOVX    @DPTR,A
    145            GenericApp_TransID = 0;
   \   000010   90....       MOV     DPTR,#GenericApp_TransID
   \   000013   E4           CLR     A
   \   000014   F0           MOVX    @DPTR,A
    146          
    147            // Device hardware initialization can be added here or in main() (Zmain.c).
    148            // If the hardware is application specific - add it here.  
    149            P0SEL &= 0xe1; // 1110 0001
   \   000015   53F3E1       ANL     0xf3,#0xe1
    150            P0DIR |= ~0xe1;
   \   000018   43FD1E       ORL     0xfd,#0x1e
    151            
    152            // If the hardware is other parts of the device add it in main().
    153          
    154            GenericApp_DstAddr.addrMode = (afAddrMode_t)AddrNotPresent;
   \   00001B   90....       MOV     DPTR,#GenericApp_DstAddr + 8
   \   00001E   F0           MOVX    @DPTR,A
    155            GenericApp_DstAddr.endPoint = 0;
   \   00001F   A3           INC     DPTR
   \   000020   F0           MOVX    @DPTR,A
    156            GenericApp_DstAddr.addr.shortAddr = 0;
   \   000021   90....       MOV     DPTR,#GenericApp_DstAddr
   \   000024   F0           MOVX    @DPTR,A
   \   000025   A3           INC     DPTR
   \   000026   F0           MOVX    @DPTR,A
    157          
    158            // Fill out the endpoint description.
    159            GenericApp_epDesc.endPoint = GENERICAPP_ENDPOINT;
   \   000027   90....       MOV     DPTR,#GenericApp_epDesc
   \   00002A   740A         MOV     A,#0xa
   \   00002C   F0           MOVX    @DPTR,A
    160            GenericApp_epDesc.task_id = &GenericApp_TaskID;
   \   00002D   A3           INC     DPTR
   \   00002E   74..         MOV     A,#GenericApp_TaskID & 0xff
   \   000030   F0           MOVX    @DPTR,A
   \   000031   A3           INC     DPTR
   \   000032   74..         MOV     A,#(GenericApp_TaskID >> 8) & 0xff
   \   000034   F0           MOVX    @DPTR,A
    161            GenericApp_epDesc.simpleDesc = (SimpleDescriptionFormat_t *)&GenericApp_SimpleDesc;
   \   000035   A3           INC     DPTR
   \   000036   74..         MOV     A,#GenericApp_SimpleDesc & 0xff
   \   000038   F0           MOVX    @DPTR,A
   \   000039   A3           INC     DPTR
   \   00003A   74..         MOV     A,#(GenericApp_SimpleDesc >> 8) & 0xff
   \   00003C   F0           MOVX    @DPTR,A
    162            GenericApp_epDesc.latencyReq = noLatencyReqs;
   \   00003D   A3           INC     DPTR
   \   00003E   E4           CLR     A
   \   00003F   F0           MOVX    @DPTR,A
    163          
    164            // Register the endpoint description with the AF
    165            afRegister( &GenericApp_epDesc );
   \   000040                ; Setup parameters for call to function afRegister
   \   000040   7A..         MOV     R2,#GenericApp_epDesc & 0xff
   \   000042   7B..         MOV     R3,#(GenericApp_epDesc >> 8) & 0xff
   \   000044   12....       LCALL   ??afRegister?relay
    166          
    167            // Register for all key events - This app will handle all key events
    168            RegisterForKeys( GenericApp_TaskID );
   \   000047                ; Setup parameters for call to function RegisterForKeys
   \   000047   90....       MOV     DPTR,#GenericApp_TaskID
   \   00004A   E0           MOVX    A,@DPTR
   \   00004B   F9           MOV     R1,A
   \   00004C   12....       LCALL   ??RegisterForKeys?relay
    169          
    170            // Update the display
    171          #if defined ( LCD_SUPPORTED )
    172              HalLcdWriteString( "GenericApp", HAL_LCD_LINE_1 );
   \   00004F                ; Setup parameters for call to function HalLcdWriteString
   \   00004F   7901         MOV     R1,#0x1
   \   000051   7A..         MOV     R2,#`?<Constant "GenericApp">` & 0xff
   \   000053   7B..         MOV     R3,#(`?<Constant "GenericApp">` >> 8) & 0xff
   \   000055   12....       LCALL   ??HalLcdWriteString?relay
    173          #endif
    174              
    175            ZDO_RegisterForZDOMsg( GenericApp_TaskID, End_Device_Bind_rsp );
   \   000058                ; Setup parameters for call to function ZDO_RegisterForZDOMsg
   \   000058   7A20         MOV     R2,#0x20
   \   00005A   7B80         MOV     R3,#-0x80
   \   00005C   90....       MOV     DPTR,#GenericApp_TaskID
   \   00005F   E0           MOVX    A,@DPTR
   \   000060   F9           MOV     R1,A
   \   000061   12....       LCALL   ??ZDO_RegisterForZDOMsg?relay
    176            ZDO_RegisterForZDOMsg( GenericApp_TaskID, Match_Desc_rsp );
   \   000064                ; Setup parameters for call to function ZDO_RegisterForZDOMsg
   \   000064   7A06         MOV     R2,#0x6
   \   000066   7B80         MOV     R3,#-0x80
   \   000068   90....       MOV     DPTR,#GenericApp_TaskID
   \   00006B   E0           MOVX    A,@DPTR
   \   00006C   F9           MOV     R1,A
   \   00006D   12....       LCALL   ??ZDO_RegisterForZDOMsg?relay
    177          }
   \   000070   7F01         MOV     R7,#0x1
   \   000072   02....       LJMP    ?BANKED_LEAVE_XDATA
   \   000075                REQUIRE P0SEL
   \   000075                REQUIRE P0DIR
    178          
    179          /*********************************************************************
    180           * @fn      GenericApp_ProcessEvent
    181           *
    182           * @brief   Generic Application Task event processor.  This function
    183           *          is called to process all events for the task.  Events
    184           *          include timers, messages and any other user defined events.
    185           *
    186           * @param   task_id  - The OSAL assigned task ID.
    187           * @param   events - events to process.  This is a bit map and can
    188           *                   contain more than one event.
    189           *
    190           * @return  none
    191           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    192          UINT16 GenericApp_ProcessEvent( byte task_id, UINT16 events )
   \                     GenericApp_ProcessEvent:
    193          {
   \   000000   74F4         MOV     A,#-0xc
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 12
   \   000005                ; Auto size: 0
   \   000005   EA           MOV     A,R2
   \   000006   FE           MOV     R6,A
   \   000007   EB           MOV     A,R3
   \   000008   FF           MOV     R7,A
    194            afIncomingMSGPacket_t *MSGpkt;
    195            afDataConfirm_t *afDataConfirm;
    196          
    197            // Data Confirmation message fields
    198            byte sentEP;
    199            ZStatus_t sentStatus;
    200            byte sentTransID;       // This should match the value sent
    201            (void)task_id;  // Intentionally unreferenced parameter
    202          
    203            if ( events & SYS_EVENT_MSG )
   \   000009   5480         ANL     A,#0x80
   \   00000B   7003         JNZ     $+5
   \   00000D   02....       LJMP    ??GenericApp_ProcessEvent_0 & 0xFFFF
    204            {
    205              MSGpkt = (afIncomingMSGPacket_t *)osal_msg_receive( GenericApp_TaskID );
   \   000010                ; Setup parameters for call to function osal_msg_receive
   \   000010   802B         SJMP    ??GenericApp_ProcessEvent_1
    206              while ( MSGpkt )
    207              {
    208                switch ( MSGpkt->hdr.event )
    209                {
    210                  case ZDO_CB_MSG:
    211                    GenericApp_ProcessZDOMsgs( (zdoIncomingMsg_t *)MSGpkt );
    212                    break;
    213                    
    214                  case KEY_CHANGE:
    215                    GenericApp_HandleKeys( ((keyChange_t *)MSGpkt)->state, ((keyChange_t *)MSGpkt)->keys );
    216                    break;
    217          
    218                  case AF_DATA_CONFIRM_CMD:
    219                    // This message is received as a confirmation of a data packet sent.
    220                    // The status is of ZStatus_t type [defined in ZComDef.h]
    221                    // The message fields are defined in AF.h
    222                    afDataConfirm = (afDataConfirm_t *)MSGpkt;
    223                    sentEP = afDataConfirm->endpoint;
    224                    sentStatus = afDataConfirm->hdr.status;
    225                    sentTransID = afDataConfirm->transID;
    226                    (void)sentEP;
    227                    (void)sentTransID;
    228          
    229                    // Action taken when confirmation is received.
    230                    if ( sentStatus != ZSuccess )
    231                    {
    232                      // The data wasn't delivered -- Do something
    233                    }
    234                    break;
    235          
    236                  case AF_INCOMING_MSG_CMD:
    237                    GenericApp_MessageMSGCB( MSGpkt );
    238                    break;
    239          
    240                  case ZDO_STATE_CHANGE:
    241                    GenericApp_NwkState = (devStates_t)(MSGpkt->hdr.status);
   \                     ??GenericApp_ProcessEvent_2:
   \   000012   A3           INC     DPTR
   \   000013   E0           MOVX    A,@DPTR
   \   000014   90....       MOV     DPTR,#GenericApp_NwkState
   \   000017   F0           MOVX    @DPTR,A
    242                    if ( (GenericApp_NwkState == DEV_ZB_COORD)
    243                        || (GenericApp_NwkState == DEV_ROUTER)
    244                        || (GenericApp_NwkState == DEV_END_DEVICE) )
   \   000018   6409         XRL     A,#0x9
   \   00001A   600A         JZ      ??GenericApp_ProcessEvent_3
   \   00001C   E0           MOVX    A,@DPTR
   \   00001D   6407         XRL     A,#0x7
   \   00001F   6005         JZ      ??GenericApp_ProcessEvent_3
   \   000021   E0           MOVX    A,@DPTR
   \   000022   6406         XRL     A,#0x6
   \   000024   7010         JNZ     ??GenericApp_ProcessEvent_4
    245                    {
    246                      // Start sending "the" message in a regular interval.
    247                      osal_start_timerEx( GenericApp_TaskID,
    248                                          GENERICAPP_SEND_MSG_EVT,
    249                                        GENERICAPP_SEND_MSG_TIMEOUT );
   \                     ??GenericApp_ProcessEvent_3:
   \   000026                ; Setup parameters for call to function osal_start_timerEx
   \   000026   7C88         MOV     R4,#-0x78
   \   000028   7D13         MOV     R5,#0x13
   \   00002A   7A01         MOV     R2,#0x1
   \   00002C   7B00         MOV     R3,#0x0
   \   00002E   90....       MOV     DPTR,#GenericApp_TaskID
   \   000031   E0           MOVX    A,@DPTR
   \   000032   F9           MOV     R1,A
   \   000033   12....       LCALL   ??osal_start_timerEx?relay
    250                    }
    251                    break;
    252          
    253                  default:
    254                    break;
    255                }
    256          
    257                // Release the memory
    258                osal_msg_deallocate( (uint8 *)MSGpkt );
   \                     ??GenericApp_ProcessEvent_4:
   \   000036                ; Setup parameters for call to function osal_msg_deallocate
   \   000036   AA..         MOV     R2,?V0 + 0
   \   000038   AB..         MOV     R3,?V0 + 1
   \   00003A   12....       LCALL   ??osal_msg_deallocate?relay
    259          
    260                // Next
    261                MSGpkt = (afIncomingMSGPacket_t *)osal_msg_receive( GenericApp_TaskID );
   \   00003D                ; Setup parameters for call to function osal_msg_receive
   \                     ??GenericApp_ProcessEvent_1:
   \   00003D   90....       MOV     DPTR,#GenericApp_TaskID
   \   000040   E0           MOVX    A,@DPTR
   \   000041   F9           MOV     R1,A
   \   000042   12....       LCALL   ??osal_msg_receive?relay
   \   000045   8A..         MOV     ?V0 + 0,R2
   \   000047   8B..         MOV     ?V0 + 1,R3
   \   000049   E5..         MOV     A,?V0 + 0
   \   00004B   45..         ORL     A,?V0 + 1
   \   00004D   603D         JZ      ??GenericApp_ProcessEvent_5
   \   00004F   85..82       MOV     DPL,?V0 + 0
   \   000052   85..83       MOV     DPH,?V0 + 1
   \   000055   E0           MOVX    A,@DPTR
   \   000056   24E6         ADD     A,#-0x1a
   \   000058   6029         JZ      ??GenericApp_ProcessEvent_6
   \   00005A   245A         ADD     A,#0x5a
   \   00005C   6011         JZ      ??GenericApp_ProcessEvent_7
   \   00005E   24EF         ADD     A,#-0x11
   \   000060   60B0         JZ      ??GenericApp_ProcessEvent_2
   \   000062   24FE         ADD     A,#-0x2
   \   000064   70D0         JNZ     ??GenericApp_ProcessEvent_4
   \   000066                ; Setup parameters for call to function GenericApp_ProcessZDOMsgs
   \   000066   AA..         MOV     R2,?V0 + 0
   \   000068   AB..         MOV     R3,?V0 + 1
   \   00006A   12....       LCALL   ??GenericApp_ProcessZDOMsgs?relay
   \   00006D   80C7         SJMP    ??GenericApp_ProcessEvent_4
   \                     ??GenericApp_ProcessEvent_7:
   \   00006F                ; Setup parameters for call to function GenericApp_HandleKeys
   \   00006F   A3           INC     DPTR
   \   000070   A3           INC     DPTR
   \   000071   A3           INC     DPTR
   \   000072   E0           MOVX    A,@DPTR
   \   000073   FA           MOV     R2,A
   \   000074   85..82       MOV     DPL,?V0 + 0
   \   000077   85..83       MOV     DPH,?V0 + 1
   \   00007A   A3           INC     DPTR
   \   00007B   A3           INC     DPTR
   \   00007C   E0           MOVX    A,@DPTR
   \   00007D   F9           MOV     R1,A
   \   00007E   12....       LCALL   ??GenericApp_HandleKeys?relay
   \   000081   80B3         SJMP    ??GenericApp_ProcessEvent_4
   \                     ??GenericApp_ProcessEvent_6:
   \   000083                ; Setup parameters for call to function GenericApp_MessageMSGCB
   \   000083   AA..         MOV     R2,?V0 + 0
   \   000085   AB..         MOV     R3,?V0 + 1
   \   000087   12....       LCALL   ??GenericApp_MessageMSGCB?relay
   \   00008A   80AA         SJMP    ??GenericApp_ProcessEvent_4
    262              }
    263          
    264              // return unprocessed events
    265              return (events ^ SYS_EVENT_MSG);
   \                     ??GenericApp_ProcessEvent_5:
   \   00008C   EE           MOV     A,R6
   \   00008D   FA           MOV     R2,A
   \   00008E   EF           MOV     A,R7
   \   00008F   6480         XRL     A,#0x80
   \                     ??GenericApp_ProcessEvent_8:
   \   000091   FB           MOV     R3,A
   \   000092   8023         SJMP    ??GenericApp_ProcessEvent_9
    266            }
    267          
    268            // Send a message out - This event is generated by a timer
    269            //  (setup in GenericApp_Init()).
    270            if ( events & GENERICAPP_SEND_MSG_EVT )
   \                     ??GenericApp_ProcessEvent_0:
   \   000094   EE           MOV     A,R6
   \   000095   A2E0         MOV     C,0xE0 /* A   */.0
   \   000097   501A         JNC     ??GenericApp_ProcessEvent_10
    271            {
    272              // Send "the" message
    273              GenericApp_SendTheMessage();
   \   000099                ; Setup parameters for call to function GenericApp_SendTheMessage
   \   000099   12....       LCALL   ??GenericApp_SendTheMessage?relay
    274          
    275              // Setup to send message again
    276              osal_start_timerEx( GenericApp_TaskID,
    277                                  GENERICAPP_SEND_MSG_EVT,
    278                                GENERICAPP_SEND_MSG_TIMEOUT );
   \   00009C                ; Setup parameters for call to function osal_start_timerEx
   \   00009C   7C88         MOV     R4,#-0x78
   \   00009E   7D13         MOV     R5,#0x13
   \   0000A0   7A01         MOV     R2,#0x1
   \   0000A2   7B00         MOV     R3,#0x0
   \   0000A4   90....       MOV     DPTR,#GenericApp_TaskID
   \   0000A7   E0           MOVX    A,@DPTR
   \   0000A8   F9           MOV     R1,A
   \   0000A9   12....       LCALL   ??osal_start_timerEx?relay
    279          
    280              // return unprocessed events
    281              return (events ^ GENERICAPP_SEND_MSG_EVT);
   \   0000AC   EE           MOV     A,R6
   \   0000AD   6401         XRL     A,#0x1
   \   0000AF   FA           MOV     R2,A
   \   0000B0   EF           MOV     A,R7
   \   0000B1   80DE         SJMP    ??GenericApp_ProcessEvent_8
    282            }
    283          
    284            // Discard unknown events
    285            return 0;
   \                     ??GenericApp_ProcessEvent_10:
   \   0000B3   7A00         MOV     R2,#0x0
   \   0000B5   7B00         MOV     R3,#0x0
   \                     ??GenericApp_ProcessEvent_9:
   \   0000B7                REQUIRE ?Subroutine0
   \   0000B7                ; // Fall through to label ?Subroutine0
    286          }

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine0:
   \   000000   7F04         MOV     R7,#0x4
   \   000002   02....       LJMP    ?BANKED_LEAVE_XDATA
    287          
    288          /*********************************************************************
    289           * Event Generation Functions
    290           */
    291          
    292          /*********************************************************************
    293           * @fn      GenericApp_ProcessZDOMsgs()
    294           *
    295           * @brief   Process response messages
    296           *
    297           * @param   none
    298           *
    299           * @return  none
    300           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    301          void GenericApp_ProcessZDOMsgs( zdoIncomingMsg_t *inMsg )
   \                     GenericApp_ProcessZDOMsgs:
    302          {
   \   000000   74F6         MOV     A,#-0xa
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 10
   \   000005                ; Auto size: 0
    303            switch ( inMsg->clusterID )
   \   000005   EA           MOV     A,R2
   \   000006   240C         ADD     A,#0xc
   \   000008   F582         MOV     DPL,A
   \   00000A   EB           MOV     A,R3
   \   00000B   3400         ADDC    A,#0x0
   \   00000D   F583         MOV     DPH,A
   \   00000F   E0           MOVX    A,@DPTR
   \   000010   F5..         MOV     ?V0 + 0,A
   \   000012   A3           INC     DPTR
   \   000013   E0           MOVX    A,@DPTR
   \   000014   F5..         MOV     ?V0 + 1,A
   \   000016   78..         MOV     R0,#?V0 + 0
   \   000018   12....       LCALL   ?US_SWITCH_SPARSE
   \                     `?<Jumptable for GenericApp_ProcessZDOMsgs>_0`:
   \   00001B   0000         DW        0
   \   00001D   0200         DW        2
   \   00001F   0680         DW        32774
   \   000021   ....         DW        ??GenericApp_ProcessZDOMsgs_0
   \   000023   2080         DW        32800
   \   000025   ....         DW        ??GenericApp_ProcessZDOMsgs_1
   \   000027   ....         DW        ??GenericApp_ProcessZDOMsgs_2
    304            {
    305              case End_Device_Bind_rsp:
    306                if ( ZDO_ParseBindRsp( inMsg ) == ZSuccess )
   \                     ??GenericApp_ProcessZDOMsgs_1:
   \   000029   EA           MOV     A,R2
   \   00002A   2413         ADD     A,#0x13
   \   00002C   F582         MOV     DPL,A
   \   00002E   EB           MOV     A,R3
   \   00002F   3400         ADDC    A,#0x0
   \   000031   F583         MOV     DPH,A
   \   000033   E0           MOVX    A,@DPTR
   \   000034   F8           MOV     R0,A
   \   000035   A3           INC     DPTR
   \   000036   E0           MOVX    A,@DPTR
   \   000037   F583         MOV     DPH,A
   \   000039   8882         MOV     DPL,R0
   \   00003B   E0           MOVX    A,@DPTR
   \   00003C   7009         JNZ     ??GenericApp_ProcessZDOMsgs_3
    307                {
    308                  // Light LED
    309                  HalLedSet( HAL_LED_4, HAL_LED_MODE_ON );
   \   00003E                ; Setup parameters for call to function HalLedSet
   \   00003E   7A01         MOV     R2,#0x1
   \                     ??GenericApp_ProcessZDOMsgs_4:
   \   000040   7908         MOV     R1,#0x8
   \   000042   12....       LCALL   ??HalLedSet?relay
   \   000045   8053         SJMP    ??GenericApp_ProcessZDOMsgs_2
    310                }
    311          #if defined(BLINK_LEDS)
    312                else
    313                {
    314                  // Flash LED to show failure
    315                  HalLedSet ( HAL_LED_4, HAL_LED_MODE_FLASH );
   \                     ??GenericApp_ProcessZDOMsgs_3:
   \   000047                ; Setup parameters for call to function HalLedSet
   \   000047   7A04         MOV     R2,#0x4
   \   000049   80F5         SJMP    ??GenericApp_ProcessZDOMsgs_4
    316                }
    317          #endif
    318                break;
    319          
    320              case Match_Desc_rsp:
    321                {
    322                  ZDO_ActiveEndpointRsp_t *pRsp = ZDO_ParseEPListRsp( inMsg );
   \                     ??GenericApp_ProcessZDOMsgs_0:
   \   00004B                ; Setup parameters for call to function ZDO_ParseEPListRsp
   \   00004B   12....       LCALL   ??ZDO_ParseEPListRsp?relay
   \   00004E   8A..         MOV     ?V0 + 0,R2
   \   000050   8B..         MOV     ?V0 + 1,R3
   \   000052   AE..         MOV     R6,?V0 + 0
   \   000054   AF..         MOV     R7,?V0 + 1
    323                  if ( pRsp )
   \   000056   EE           MOV     A,R6
   \   000057   4F           ORL     A,R7
   \   000058   6040         JZ      ??GenericApp_ProcessZDOMsgs_2
    324                  {
    325                    if ( pRsp->status == ZSuccess && pRsp->cnt )
   \   00005A   8E82         MOV     DPL,R6
   \   00005C   8F83         MOV     DPH,R7
   \   00005E   E0           MOVX    A,@DPTR
   \   00005F   7032         JNZ     ??GenericApp_ProcessZDOMsgs_5
   \   000061   A3           INC     DPTR
   \   000062   A3           INC     DPTR
   \   000063   A3           INC     DPTR
   \   000064   E0           MOVX    A,@DPTR
   \   000065   602C         JZ      ??GenericApp_ProcessZDOMsgs_5
    326                    {
    327                      GenericApp_DstAddr.addrMode = (afAddrMode_t)Addr16Bit;
   \   000067   90....       MOV     DPTR,#GenericApp_DstAddr + 8
   \   00006A   7402         MOV     A,#0x2
   \   00006C   F0           MOVX    @DPTR,A
    328                      GenericApp_DstAddr.addr.shortAddr = pRsp->nwkAddr;
   \   00006D   8E82         MOV     DPL,R6
   \   00006F   8F83         MOV     DPH,R7
   \   000071   A3           INC     DPTR
   \   000072   E0           MOVX    A,@DPTR
   \   000073   F8           MOV     R0,A
   \   000074   A3           INC     DPTR
   \   000075   E0           MOVX    A,@DPTR
   \   000076   F9           MOV     R1,A
   \   000077   90....       MOV     DPTR,#GenericApp_DstAddr
   \   00007A   E8           MOV     A,R0
   \   00007B   F0           MOVX    @DPTR,A
   \   00007C   A3           INC     DPTR
   \   00007D   E9           MOV     A,R1
   \   00007E   F0           MOVX    @DPTR,A
    329                      // Take the first endpoint, Can be changed to search through endpoints
    330                      GenericApp_DstAddr.endPoint = pRsp->epList[0];
   \   00007F   8E82         MOV     DPL,R6
   \   000081   8F83         MOV     DPH,R7
   \   000083   A3           INC     DPTR
   \   000084   A3           INC     DPTR
   \   000085   A3           INC     DPTR
   \   000086   A3           INC     DPTR
   \   000087   E0           MOVX    A,@DPTR
   \   000088   90....       MOV     DPTR,#GenericApp_DstAddr + 9
   \   00008B   F0           MOVX    @DPTR,A
    331          
    332                      // Light LED
    333                      HalLedSet( HAL_LED_4, HAL_LED_MODE_ON );
   \   00008C                ; Setup parameters for call to function HalLedSet
   \   00008C   7A01         MOV     R2,#0x1
   \   00008E   7908         MOV     R1,#0x8
   \   000090   12....       LCALL   ??HalLedSet?relay
    334                    }
    335                    osal_mem_free( pRsp );
   \                     ??GenericApp_ProcessZDOMsgs_5:
   \   000093                ; Setup parameters for call to function osal_mem_free
   \   000093   EE           MOV     A,R6
   \   000094   FA           MOV     R2,A
   \   000095   EF           MOV     A,R7
   \   000096   FB           MOV     R3,A
   \   000097   12....       LCALL   ??osal_mem_free?relay
    336                  }
    337                }
    338                break;
    339            }
    340          }
   \                     ??GenericApp_ProcessZDOMsgs_2:
   \   00009A                REQUIRE ?Subroutine1
   \   00009A                ; // Fall through to label ?Subroutine1

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine1:
   \   000000   7F02         MOV     R7,#0x2
   \   000002   02....       LJMP    ?BANKED_LEAVE_XDATA
    341          
    342          /*********************************************************************
    343           * @fn      GenericApp_HandleKeys
    344           *
    345           * @brief   Handles all key events for this device.
    346           *
    347           * @param   shift - true if in shift/alt.
    348           * @param   keys - bit field for key events. Valid entries:
    349           *                 HAL_KEY_SW_4
    350           *                 HAL_KEY_SW_3
    351           *                 HAL_KEY_SW_2
    352           *                 HAL_KEY_SW_1
    353           *
    354           * @return  none
    355           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    356          void GenericApp_HandleKeys( byte shift, byte keys )
   \                     GenericApp_HandleKeys:
    357          {
   \   000000   74F4         MOV     A,#-0xc
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 12
   \   000005                ; Auto size: 9
   \   000005   74F7         MOV     A,#-0x9
   \   000007   12....       LCALL   ?ALLOC_XSTACK8
   \   00000A   E9           MOV     A,R1
   \   00000B   FE           MOV     R6,A
   \   00000C   EA           MOV     A,R2
   \   00000D   FF           MOV     R7,A
    358            zAddrType_t dstAddr;
    359            
    360            // Shift is used to make each button/switch dual purpose.
    361            if ( shift )
   \   00000E   EE           MOV     A,R6
   \   00000F   6003         JZ      $+5
   \   000011   02....       LJMP    ??GenericApp_HandleKeys_0 & 0xFFFF
    362            {
    363              if ( keys & HAL_KEY_SW_1 )
    364              {
    365              }
    366              if ( keys & HAL_KEY_SW_2 )
    367              {
    368              }
    369              if ( keys & HAL_KEY_SW_3 )
    370              {
    371              }
    372              if ( keys & HAL_KEY_SW_4 )
    373              {
    374              }
    375            }
    376            else
    377            {
    378              if ( keys & HAL_KEY_SW_1 )
    379              {
    380              }
    381          
    382              if ( keys & HAL_KEY_SW_2 )
   \   000014   75....       MOV     ?V0 + 0,#GenericApp_ClusterList & 0xff
   \   000017   75....       MOV     ?V0 + 1,#(GenericApp_ClusterList >> 8) & 0xff
   \   00001A   EF           MOV     A,R7
   \   00001B   A2E1         MOV     C,0xE0 /* A   */.1
   \   00001D   5064         JNC     ??GenericApp_HandleKeys_1
    383              {
    384                HalLedSet ( HAL_LED_4, HAL_LED_MODE_OFF );
   \   00001F                ; Setup parameters for call to function HalLedSet
   \   00001F   7A00         MOV     R2,#0x0
   \   000021   7908         MOV     R1,#0x8
   \   000023   12....       LCALL   ??HalLedSet?relay
    385          
    386                // Initiate an End Device Bind Request for the mandatory endpoint
    387                dstAddr.addrMode = Addr16Bit;
   \   000026   7408         MOV     A,#0x8
   \   000028   12....       LCALL   ?XSTACK_DISP0_8
   \   00002B   7402         MOV     A,#0x2
   \   00002D   F0           MOVX    @DPTR,A
    388                dstAddr.addr.shortAddr = 0x0000; // Coordinator
   \   00002E   85..82       MOV     DPL,?XSP + 0
   \   000031   85..83       MOV     DPH,?XSP + 1
   \   000034   E4           CLR     A
   \   000035   F0           MOVX    @DPTR,A
   \   000036   A3           INC     DPTR
   \   000037   F0           MOVX    @DPTR,A
    389                ZDP_EndDeviceBindReq( &dstAddr, NLME_GetShortAddr(), 
    390                                      GenericApp_epDesc.endPoint,
    391                                      GENERICAPP_PROFID,
    392                                      GENERICAPP_MAX_CLUSTERS, (cId_t *)GenericApp_ClusterList,
    393                                      GENERICAPP_MAX_CLUSTERS, (cId_t *)GenericApp_ClusterList,
    394                                      FALSE );
   \   000038                ; Setup parameters for call to function NLME_GetShortAddr
   \   000038   12....       LCALL   ??NLME_GetShortAddr?relay
   \   00003B   8A..         MOV     ?V0 + 2,R2
   \   00003D   8B..         MOV     ?V0 + 3,R3
   \   00003F   AC..         MOV     R4,?V0 + 2
   \   000041   AD..         MOV     R5,?V0 + 3
   \   000043                ; Setup parameters for call to function ZDP_EndDeviceBindReq
   \   000043   75..00       MOV     ?V0 + 2,#0x0
   \   000046   78..         MOV     R0,#?V0 + 2
   \   000048   12....       LCALL   ?PUSH_XSTACK_I_ONE
   \   00004B   78..         MOV     R0,#?V0 + 0
   \   00004D   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   000050   75..01       MOV     ?V0 + 2,#0x1
   \   000053   78..         MOV     R0,#?V0 + 2
   \   000055   12....       LCALL   ?PUSH_XSTACK_I_ONE
   \   000058   78..         MOV     R0,#?V0 + 0
   \   00005A   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   00005D   78..         MOV     R0,#?V0 + 2
   \   00005F   12....       LCALL   ?PUSH_XSTACK_I_ONE
   \   000062   75..04       MOV     ?V0 + 2,#0x4
   \   000065   75..0F       MOV     ?V0 + 3,#0xf
   \   000068   78..         MOV     R0,#?V0 + 2
   \   00006A   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   00006D   90....       MOV     DPTR,#GenericApp_epDesc
   \   000070   E0           MOVX    A,@DPTR
   \   000071   F9           MOV     R1,A
   \   000072   7409         MOV     A,#0x9
   \   000074   12....       LCALL   ?XSTACK_DISP0_8
   \   000077   AA82         MOV     R2,DPL
   \   000079   AB83         MOV     R3,DPH
   \   00007B   12....       LCALL   ??ZDP_EndDeviceBindReq?relay
   \   00007E   7409         MOV     A,#0x9
   \   000080   12....       LCALL   ?DEALLOC_XSTACK8
    395              }
    396          
    397              if ( keys & HAL_KEY_SW_3 )
    398              {
    399              }
    400          
    401              if ( keys & HAL_KEY_SW_4 )
   \                     ??GenericApp_HandleKeys_1:
   \   000083   EF           MOV     A,R7
   \   000084   A2E3         MOV     C,0xE0 /* A   */.3
   \   000086   5056         JNC     ??GenericApp_HandleKeys_0
    402              {
    403                HalLedSet ( HAL_LED_4, HAL_LED_MODE_OFF );
   \   000088                ; Setup parameters for call to function HalLedSet
   \   000088   7A00         MOV     R2,#0x0
   \   00008A   7908         MOV     R1,#0x8
   \   00008C   12....       LCALL   ??HalLedSet?relay
    404                // Initiate a Match Description Request (Service Discovery)
    405                dstAddr.addrMode = AddrBroadcast;
   \   00008F   7408         MOV     A,#0x8
   \   000091   12....       LCALL   ?XSTACK_DISP0_8
   \   000094   740F         MOV     A,#0xf
   \   000096   F0           MOVX    @DPTR,A
    406                dstAddr.addr.shortAddr = NWK_BROADCAST_SHORTADDR;
   \   000097   85..82       MOV     DPL,?XSP + 0
   \   00009A   85..83       MOV     DPH,?XSP + 1
   \   00009D   74FF         MOV     A,#-0x1
   \   00009F   F0           MOVX    @DPTR,A
   \   0000A0   A3           INC     DPTR
   \   0000A1   F0           MOVX    @DPTR,A
    407                ZDP_MatchDescReq( &dstAddr, NWK_BROADCAST_SHORTADDR,
    408                                  GENERICAPP_PROFID,
    409                                  GENERICAPP_MAX_CLUSTERS, (cId_t *)GenericApp_ClusterList,
    410                                  GENERICAPP_MAX_CLUSTERS, (cId_t *)GenericApp_ClusterList,
    411                                  FALSE );
   \   0000A2                ; Setup parameters for call to function ZDP_MatchDescReq
   \   0000A2   75..00       MOV     ?V0 + 2,#0x0
   \   0000A5   78..         MOV     R0,#?V0 + 2
   \   0000A7   12....       LCALL   ?PUSH_XSTACK_I_ONE
   \   0000AA   78..         MOV     R0,#?V0 + 0
   \   0000AC   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   0000AF   75..01       MOV     ?V0 + 2,#0x1
   \   0000B2   78..         MOV     R0,#?V0 + 2
   \   0000B4   12....       LCALL   ?PUSH_XSTACK_I_ONE
   \   0000B7   78..         MOV     R0,#?V0 + 0
   \   0000B9   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   0000BC   75..04       MOV     ?V0 + 0,#0x4
   \   0000BF   75..0F       MOV     ?V0 + 1,#0xf
   \   0000C2   78..         MOV     R0,#?V0 + 0
   \   0000C4   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   0000C7   7901         MOV     R1,#0x1
   \   0000C9   7CFF         MOV     R4,#-0x1
   \   0000CB   7DFF         MOV     R5,#-0x1
   \   0000CD   7408         MOV     A,#0x8
   \   0000CF   12....       LCALL   ?XSTACK_DISP0_8
   \   0000D2   AA82         MOV     R2,DPL
   \   0000D4   AB83         MOV     R3,DPH
   \   0000D6   12....       LCALL   ??ZDP_MatchDescReq?relay
   \   0000D9   7408         MOV     A,#0x8
   \   0000DB   12....       LCALL   ?DEALLOC_XSTACK8
    412              }
    413            }
    414          }
   \                     ??GenericApp_HandleKeys_0:
   \   0000DE   7409         MOV     A,#0x9
   \   0000E0   12....       LCALL   ?DEALLOC_XSTACK8
   \   0000E3   02....       LJMP    ?Subroutine0 & 0xFFFF
    415          
    416          /*********************************************************************
    417           * LOCAL FUNCTIONS
    418           */
    419          
    420          /*********************************************************************
    421           * @fn      GenericApp_MessageMSGCB
    422           *
    423           * @brief   Data message processor callback.  This function processes
    424           *          any incoming data - probably from other devices.  So, based
    425           *          on cluster ID, perform the intended action.
    426           *
    427           * @param   none
    428           *
    429           * @return  none
    430           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    431          void GenericApp_MessageMSGCB( afIncomingMSGPacket_t *pkt )
   \                     GenericApp_MessageMSGCB:
    432          {
   \   000000   C082         PUSH    DPL
   \   000002   C083         PUSH    DPH
   \   000004                ; Saved register size: 2
   \   000004                ; Auto size: 0
    433            switch ( pkt->clusterId )
   \   000004   8A82         MOV     DPL,R2
   \   000006   8B83         MOV     DPH,R3
   \   000008   A3           INC     DPTR
   \   000009   A3           INC     DPTR
   \   00000A   A3           INC     DPTR
   \   00000B   A3           INC     DPTR
   \   00000C   E0           MOVX    A,@DPTR
   \   00000D   6401         XRL     A,#0x1
   \   00000F   7002         JNZ     ??GenericApp_MessageMSGCB_0
   \   000011   A3           INC     DPTR
   \   000012   E0           MOVX    A,@DPTR
   \                     ??GenericApp_MessageMSGCB_0:
   \   000013   7016         JNZ     ??GenericApp_MessageMSGCB_1
    434            {
    435              case GENERICAPP_CLUSTERID:
    436                // "the" message
    437          #if defined( LCD_SUPPORTED )
    438                HalLcdWriteScreen( (char*)pkt->cmd.Data, "rcvd" );
   \   000015                ; Setup parameters for call to function HalLcdWriteScreen
   \   000015   7C..         MOV     R4,#`?<Constant "rcvd">` & 0xff
   \   000017   7D..         MOV     R5,#(`?<Constant "rcvd">` >> 8) & 0xff
   \   000019   EA           MOV     A,R2
   \   00001A   2421         ADD     A,#0x21
   \   00001C   F582         MOV     DPL,A
   \   00001E   EB           MOV     A,R3
   \   00001F   3400         ADDC    A,#0x0
   \   000021   F583         MOV     DPH,A
   \   000023   E0           MOVX    A,@DPTR
   \   000024   FA           MOV     R2,A
   \   000025   A3           INC     DPTR
   \   000026   E0           MOVX    A,@DPTR
   \   000027   FB           MOV     R3,A
   \   000028   12....       LCALL   ??HalLcdWriteScreen?relay
    439          #elif defined( WIN32 )
    440                WPRINTSTR( pkt->cmd.Data );
    441          #endif
    442                break;
    443            }
    444          }
   \                     ??GenericApp_MessageMSGCB_1:
   \   00002B   D083         POP     DPH
   \   00002D   D082         POP     DPL
   \   00002F   02....       LJMP    ?BRET
    445          
    446          /*********************************************************************
    447           * @fn      GenericApp_SendTheMessage
    448           *
    449           * @brief   Send "the" message.
    450           *
    451           * @param   none
    452           *
    453           * @return  none
    454           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    455          void GenericApp_SendTheMessage( void )
   \                     GenericApp_SendTheMessage:
    456          {
   \   000000   74F6         MOV     A,#-0xa
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 10
   \   000005                ; Auto size: 12
   \   000005   74F4         MOV     A,#-0xc
   \   000007   12....       LCALL   ?ALLOC_XSTACK8
    457            char theMessageData[] = "Hello World";
   \   00000A   85..82       MOV     DPL,?XSP + 0
   \   00000D   85..83       MOV     DPH,?XSP + 1
   \   000010   AC82         MOV     R4,DPL
   \   000012   AD83         MOV     R5,DPH
   \   000014   7583..       MOV     DPH,#(`?<Constant "Hello World">` >> 8) & 0xff
   \   000017   7582..       MOV     DPL,#`?<Constant "Hello World">` & 0xff
   \   00001A   740C         MOV     A,#0xc
   \   00001C   12....       LCALL   ?MOVE_LONG8_XDATA_XDATA
    458          
    459            if ( AF_DataRequest( &GenericApp_DstAddr, &GenericApp_epDesc,
    460                                 GENERICAPP_CLUSTERID,
    461                                 (byte)osal_strlen( theMessageData ) + 1,
    462                                 (byte *)&theMessageData,
    463                                 &GenericApp_TransID,
    464                                 AF_DISCV_ROUTE, AF_DEFAULT_RADIUS ) == afStatus_SUCCESS )
   \   00001F                ; Setup parameters for call to function AF_DataRequest
   \   00001F   75..1E       MOV     ?V0 + 0,#0x1e
   \   000022   78..         MOV     R0,#?V0 + 0
   \   000024   12....       LCALL   ?PUSH_XSTACK_I_ONE
   \   000027   75....       MOV     ?V0 + 0,#GenericApp_TransID & 0xff
   \   00002A   75....       MOV     ?V0 + 1,#(GenericApp_TransID >> 8) & 0xff
   \   00002D   78..         MOV     R0,#?V0 + 0
   \   00002F   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   000032   7403         MOV     A,#0x3
   \   000034   12....       LCALL   ?XSTACK_DISP0_8
   \   000037   8582..       MOV     ?V0 + 0,DPL
   \   00003A   8583..       MOV     ?V0 + 1,DPH
   \   00003D   78..         MOV     R0,#?V0 + 0
   \   00003F   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   000042                ; Setup parameters for call to function osal_strlen
   \   000042   7405         MOV     A,#0x5
   \   000044   12....       LCALL   ?XSTACK_DISP0_8
   \   000047   AA82         MOV     R2,DPL
   \   000049   AB83         MOV     R3,DPH
   \   00004B   12....       LCALL   ??osal_strlen?relay
   \   00004E   EA           MOV     A,R2
   \   00004F   2401         ADD     A,#0x1
   \   000051   F5..         MOV     ?V0 + 0,A
   \   000053   E4           CLR     A
   \   000054   3400         ADDC    A,#0x0
   \   000056   F5..         MOV     ?V0 + 1,A
   \   000058   78..         MOV     R0,#?V0 + 0
   \   00005A   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   00005D   75..01       MOV     ?V0 + 0,#0x1
   \   000060   75..00       MOV     ?V0 + 1,#0x0
   \   000063   78..         MOV     R0,#?V0 + 0
   \   000065   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   000068   7920         MOV     R1,#0x20
   \   00006A   7C..         MOV     R4,#GenericApp_epDesc & 0xff
   \   00006C   7D..         MOV     R5,#(GenericApp_epDesc >> 8) & 0xff
   \   00006E   7A..         MOV     R2,#GenericApp_DstAddr & 0xff
   \   000070   7B..         MOV     R3,#(GenericApp_DstAddr >> 8) & 0xff
   \   000072   12....       LCALL   ??AF_DataRequest?relay
   \   000075   7409         MOV     A,#0x9
   \   000077   12....       LCALL   ?DEALLOC_XSTACK8
    465            {
    466              // Successfully requested to be sent.
    467            }
    468            else
    469            {
    470              // Error occurred in request to send.
    471            }
    472          }
   \   00007A   740C         MOV     A,#0xc
   \   00007C   12....       LCALL   ?DEALLOC_XSTACK8
   \   00007F   02....       LJMP    ?Subroutine1 & 0xFFFF

   \                                 In  segment XDATA_ID, align 1, keep-with-next
   \                     `?<Initializer for corotation>`:
   \   000000   10           DB 16
   \   000001   08           DB 8
   \   000002   04           DB 4
   \   000003   02           DB 2

   \                                 In  segment XDATA_ID, align 1, keep-with-next
   \                     `?<Initializer for reverse>`:
   \   000000   02           DB 2
   \   000001   04           DB 4
   \   000002   08           DB 8
   \   000003   10           DB 16

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??GenericApp_Init?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    GenericApp_Init

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??GenericApp_ProcessEvent?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    GenericApp_ProcessEvent

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??GenericApp_ProcessZDOMsgs?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    GenericApp_ProcessZDOMsgs

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??GenericApp_HandleKeys?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    GenericApp_HandleKeys

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??GenericApp_MessageMSGCB?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    GenericApp_MessageMSGCB

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??GenericApp_SendTheMessage?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    GenericApp_SendTheMessage

   \                                 In  segment XDATA_ROM_C, align 1
   \                     `?<Constant "GenericApp">`:
   \   000000   47656E65     DB "GenericApp"
   \            72696341
   \            707000  

   \                                 In  segment XDATA_ROM_C, align 1
   \                     `?<Constant "rcvd">`:
   \   000000   72637664     DB "rcvd"
   \            00      

   \                                 In  segment XDATA_ROM_C, align 1
   \                     `?<Constant "Hello World">`:
   \   000000   48656C6C     DB "Hello World"
   \            6F20576F
   \            726C6400
    473          
    474          /*********************************************************************
    475          *********************************************************************/

   Maximum stack usage in bytes:

     Function                       ISTACK PSTACK XSTACK
     --------                       ------ ------ ------
     GenericApp_HandleKeys              0      0     42
       -> HalLedSet                     0      0     42
       -> NLME_GetShortAddr             0      0     42
       -> ZDP_EndDeviceBindReq          0      0     60
       -> HalLedSet                     0      0     42
       -> ZDP_MatchDescReq              0      0     58
     GenericApp_Init                    0      0      9
       -> afRegister                    0      0     18
       -> RegisterForKeys               0      0     18
       -> HalLcdWriteString             0      0     18
       -> ZDO_RegisterForZDOMsg         0      0     18
       -> ZDO_RegisterForZDOMsg         0      0     18
     GenericApp_MessageMSGCB            2      0     12
       -> HalLcdWriteScreen             4      0      0
     GenericApp_ProcessEvent            0      0     12
       -> osal_msg_receive              0      0     24
       -> osal_start_timerEx            0      0     24
       -> osal_msg_deallocate           0      0     24
       -> osal_msg_receive              0      0     24
       -> GenericApp_ProcessZDOMsgs     0      0     24
       -> GenericApp_HandleKeys         0      0     24
       -> GenericApp_MessageMSGCB       0      0     24
       -> GenericApp_SendTheMessage     0      0     24
       -> osal_start_timerEx            0      0     24
     GenericApp_ProcessZDOMsgs          0      0     22
       -> HalLedSet                     0      0     20
       -> HalLedSet                     0      0     20
       -> ZDO_ParseEPListRsp            0      0     20
       -> HalLedSet                     0      0     20
       -> osal_mem_free                 0      0     20
     GenericApp_SendTheMessage          2      0     43
       -> osal_strlen                   0      0     54
       -> AF_DataRequest                0      0     62


   Segment part sizes:

     Function/Label                    Bytes
     --------------                    -----
     P0SEL                                1
     P0DIR                                1
     GenericApp_ClusterList               2
     GenericApp_SimpleDesc               12
     GenericApp_epDesc                    6
     GenericApp_TaskID                    1
     GenericApp_NwkState                  1
     GenericApp_TransID                   1
     GenericApp_DstAddr                  12
     corotation                           4
     reverse                              4
     GenericApp_Init                    117
     GenericApp_ProcessEvent            183
     ?Subroutine0                         5
     GenericApp_ProcessZDOMsgs          154
     ?Subroutine1                         5
     GenericApp_HandleKeys              230
     GenericApp_MessageMSGCB             50
     GenericApp_SendTheMessage          130
     ?<Initializer for corotation>        4
     ?<Initializer for reverse>           4
     ??GenericApp_Init?relay              6
     ??GenericApp_ProcessEvent?relay      6
     ??GenericApp_ProcessZDOMsgs?relay    6
     ??GenericApp_HandleKeys?relay        6
     ??GenericApp_MessageMSGCB?relay      6
     ??GenericApp_SendTheMessage?relay    6
     ?<Constant "GenericApp">            11
     ?<Constant "rcvd">                   5
     ?<Constant "Hello World">           12

 
 874 bytes in segment BANKED_CODE
  36 bytes in segment BANK_RELAYS
   2 bytes in segment SFR_AN
   8 bytes in segment XDATA_I
   8 bytes in segment XDATA_ID
  42 bytes in segment XDATA_ROM_C
  21 bytes in segment XDATA_Z
 
 918 bytes of CODE  memory
  42 bytes of CONST memory
   0 bytes of DATA  memory (+ 2 bytes shared)
  29 bytes of XDATA memory

Errors: none
Warnings: none
